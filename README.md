# ICT Trading Bot - Multi-Timeframe Session Analysis

Повнофункціональний фреймворк ICT-бота для мультифреймового та сесійного аналізу, який автоматично знаходить торговельні сигнали відповідно до ICT (Inner Circle Trader) методології.

## 🎯 Основні можливості

Бот реалізує 5 ключових патернів ICT:

1. **Sweep + FVG + CISD** - Зняття ліквідності з тестом імбалансу та формуванням CISD
2. **Double Sweep** - Подвійне зняття ліквідності за короткий період
3. **Session Open Liquidity Grab** - Зняття ліквідності при відкритті торговельної сесії
4. **Break of Structure (BOS) після sweep** - Пробиття структури після зняття ліквідності
5. **Asia/Frankfurt контекст** - Використання ранніх сесій як контексту для London/NY

## 📊 Аналіз таймфреймів

Бот одночасно аналізує 5 таймфреймів:
- **M1** (1 хвилина) - внутрішньоденна структура
- **M15** (15 хвилин) - основний таймфрейм для входу
- **H4** (4 години) - фрактальний аналіз, тренд
- **D1** (день) - загальний тренд
- **W1** (тиждень) - довгостроковий контекст

## 🕐 Торговельні сесії

Бот відслідковує 4 торговельні сесії:
- **Asia** (00:00 - 09:00)
- **Frankfurt** (09:00 - 10:00)
- **London** (10:00 - 15:00)
- **New York** (15:00 - 21:00)

## 🔍 Технічні індикатори

### FVG (Fair Value Gap)
Імбаланси в ціні, які виникають при різких рухах:
- **Bullish FVG**: Low[i] > High[i-2]
- **Bearish FVG**: High[i] < Low[i-2]

### Sweep (Зняття ліквідності)
Виявлення моментів, коли ціна оновлює локальні екстремуми:
- Фрактальні sweep-и на всіх таймфреймах
- Сесійні sweep-и (зняття ліквідності попередніх сесій)

### CISD (Consolidation/Internal Structure Displacement)
Консолідація з подальшим різким рухом:
- Визначається через аналіз волатильності
- Формується на M15/M30 таймфреймах

### BOS (Break of Structure)
Пробиття локального рівня структури:
- **Bullish BOS**: пробиття попереднього максимуму
- **Bearish BOS**: пробиття попереднього мінімуму

### Тренд
Визначення тренду на основі SMA:
- Аналіз на H4 і D1 таймфреймах
- Підтвердження напрямку сигналу

## 📋 Умови генерації сигналів

### Патерн 1: Sweep + FVG + CISD
**Умови:**
- ✅ Виявлено sweep на одному з таймфреймів (M15, H4, D1, W1, M1)
- ✅ Ціна протестувала незакритий імбаланс (FVG)
- ✅ Сформовано CISD на M15
- ✅ Тренд на H4/D1 співпадає з напрямком сигналу

**Впевненість:** HIGH

### Патерн 2: Double Sweep
**Умови:**
- ✅ Два sweep-и за короткий період (в межах 10 свічок)
- ✅ Після другого sweep тестується FVG або формується CISD

**Впевненість:** VERY HIGH

### Патерн 3: Session Open Liquidity Grab
**Умови:**
- ✅ Sweep/зняття ліквідності при відкритті сесії (Frankfurt, London, NY)
- ✅ Реакція ціни на імбаланс (FVG)
- ✅ Формування CISD на M15

**Впевненість:** HIGH

### Патерн 4: BOS після sweep
**Умови:**
- ✅ Sweep супроводжується пробиттям локального рівня структури (BOS)
- ✅ Після BOS тестується FVG або формується CISD

**Впевненість:** HIGH

### Патерн 5: Asia/Frankfurt контекст
**Умови:**
- ✅ Sweep або імбаланс сформовано на Asia/Frankfurt
- ✅ Реакція на ці зони в London/NY сесіях
- ✅ Підтверджено FVG тестом

**Впевненість:** MEDIUM-HIGH

## 🚀 Використання

### Базовий запуск
```bash
python3 ict_bot.py
```

### Запуск з DEBUG режимом
```bash
python3 ict_bot.py --debug
# або
python3 ict_bot.py -d
```

DEBUG режим виводить додаткову інформацію про процес аналізу:
- Підготовку даних
- Збір сесійних даних
- Виявлення кожного сигналу в реальному часі

## 📁 Структура даних

Бот очікує CSV файли в директорії `data/`:
```
data/
├── GBPUSD_M1.csv
├── GBPUSD_M15.csv
├── GBPUSD_H4.csv
├── GBPUSD_D1.csv
└── GBPUSD_W1.csv
```

### Формат CSV файлів
```csv
Datetime,Open,High,Low,Close,Volume
2025-04-14 00:00:00,1.3000,1.3050,1.2950,1.3020,1000
2025-04-14 00:15:00,1.3020,1.3100,1.2990,1.3080,1100
```

**Обов'язкові колонки:**
- `Datetime` - дата і час у форматі ISO (YYYY-MM-DD HH:MM:SS)
- `Open` - ціна відкриття
- `High` - максимальна ціна
- `Low` - мінімальна ціна
- `Close` - ціна закриття
- `Volume` - обсяг торгів

## 📊 Формат виводу сигналів

```
--- СИГНАЛ #1 ---
Дата/Час:     2025-04-15 10:15:00
Сесія:        LONDON
Патерн:       Sweep + FVG + CISD
Тип сигналу:  BUY
Впевненість:  HIGH
Причина:      Sweep H4, FVG tested on H4, CISD on M15
Тренд H4:     up
Тренд D1:     up
Таймфрейми:   Entry: M15, Sweep: H4, Trend: H4/D1
```

### Опис полів сигналу
- **Дата/Час** - точний час виникнення сигналу
- **Сесія** - торговельна сесія (ASIA, FRANKFURT, LONDON, NEW_YORK)
- **Патерн** - тип виявленого ICT патерну
- **Тип сигналу** - BUY або SELL
- **Впевненість** - рівень впевненості (VERY HIGH, HIGH, MEDIUM-HIGH)
- **Причина** - детальний опис умов, які виконались
- **Тренд H4/D1** - напрямок тренду на вищих таймфреймах
- **Таймфрейми** - інформація про таймфрейми для входу, sweep та тренду

## 🔧 Налаштування

### Параметри, які можна змінити в коді:

#### Сесії (змінна `SESSIONS`)
```python
SESSIONS = {
    "asia": (time(0, 0), time(9, 0)),
    "frankfurt": (time(9, 0), time(10, 0)),
    "london": (time(10, 0), time(15, 0)),
    "new_york": (time(15, 0), time(21, 0)),
}
```

#### DEBUG режим
```python
DEBUG_MODE = True  # або False
```

#### Параметри детекції

**Sweep вікно:**
```python
detect_sweep(df, window=20)  # кількість свічок для пошуку екстремумів
```

**CISD вікно:**
```python
detect_cisd(df, window=10)  # кількість свічок для консолідації
```

**Тренд період:**
```python
detect_trend(df, period=20)  # період SMA
```

**BOS lookback:**
```python
detect_bos(df, lookback=10)  # кількість свічок для локальної структури
```

**Double Sweep вікно:**
```python
detect_double_sweep(df, window=10)  # період для пошуку подвійного sweep
```

## 📚 Архітектура коду

### Основні модулі

1. **Константи та конфігурація**
   - Визначення сесій
   - Налаштування DEBUG режиму

2. **Допоміжні функції**
   - `debug_print()` - вивід debug інформації
   - `get_session()` - визначення торговельної сесії
   - `get_closest_candle()` - пошук найближчої свічки

3. **Детекція індикаторів**
   - `detect_fvg()` - виявлення Fair Value Gaps
   - `detect_sweep()` - виявлення sweep
   - `detect_cisd()` - виявлення консолідації
   - `detect_bos()` - виявлення Break of Structure
   - `detect_trend()` - визначення тренду
   - `detect_double_sweep()` - виявлення подвійного sweep
   - `detect_session_sweep()` - виявлення сесійних sweep

4. **Функції перевірки патернів**
   - `check_pattern_1_sweep_fvg_cisd()`
   - `check_pattern_2_double_sweep()`
   - `check_pattern_3_session_open_grab()`
   - `check_pattern_4_bos_after_sweep()`
   - `check_pattern_5_asia_frankfurt_context()`

5. **Основна логіка**
   - `generate_signals()` - головна функція генерації сигналів
   - `collect_session_data()` - збір сесійних даних
   - `load_data()` - завантаження CSV файлів
   - `main()` - точка входу програми

## 🎓 Розширення функціоналу

### Додавання нового патерну

1. Створіть функцію перевірки патерну:
```python
def check_pattern_6_my_pattern(context: Dict) -> Optional[Dict]:
    """Опис нового патерну."""
    if not (context['condition1'] and context['condition2']):
        return None
    
    signal_type = "BUY" if context['some_direction'] == 'up' else "SELL"
    
    return {
        "pattern": "My New Pattern",
        "type": signal_type,
        "reason": "Detailed reason",
        "confidence": "HIGH"
    }
```

2. Додайте її до списку патернів у функції `generate_signals()`:
```python
patterns = [
    check_pattern_1_sweep_fvg_cisd,
    check_pattern_2_double_sweep,
    check_pattern_3_session_open_grab,
    check_pattern_4_bos_after_sweep,
    check_pattern_5_asia_frankfurt_context,
    check_pattern_6_my_pattern,  # Новий патерн
]
```

### Додавання нового індикатора

1. Створіть функцію детекції:
```python
def detect_my_indicator(df: pd.DataFrame, param1: int = 10) -> pd.DataFrame:
    """Опис індикатора."""
    df = df.copy()
    # Ваша логіка
    df['my_indicator'] = ...
    return df
```

2. Застосуйте її до відповідних таймфреймів у `generate_signals()`:
```python
h4 = detect_my_indicator(h4)
```

3. Використовуйте результати в контексті та патернах:
```python
context['my_indicator_value'] = h4_candle.get('my_indicator', False)
```

## 🐛 Troubleshooting

### Помилка: "FileNotFoundError: data/GBPUSD_*.csv"
**Рішення:** Переконайтеся, що всі необхідні CSV файли знаходяться в директорії `data/`.

### Помилка: "ModuleNotFoundError: No module named 'pandas'"
**Рішення:** Встановіть необхідні залежності:
```bash
pip install pandas numpy
```

### Не виявляються сигнали
**Можливі причини:**
- Недостатньо історичних даних (потрібно мінімум 2-3 дні)
- Умови патернів не виконуються для поточних даних
- Параметри детекції надто жорсткі

**Рішення:** Запустіть бот з `--debug` режимом для діагностики.

## 📝 Примітки

- Бот розроблений для освітніх та аналітичних цілей
- Рекомендується використовувати на історичних даних для бектестингу
- Для реального трейдингу необхідні додаткові модулі ризик-менеджменту
- Всі сигнали потребують додаткового підтвердження перед входом у позицію

## 🔄 Версії

### v1.0.0 (Поточна версія)
- Реалізація всіх 5 основних ICT патернів
- Підтримка 5 таймфреймів (M1, M15, H4, D1, W1)
- Відслідковування 4 торговельних сесій
- FVG, Sweep, CISD, BOS, Double Sweep детекція
- Підтвердження тренду на вищих таймфреймах
- DEBUG режим для діагностики
- Структурований вивід сигналів

## 📄 Ліцензія

Проект розповсюджується під ліцензією MIT.

## 👨‍💻 Автор

ICT Trading Bot Framework

---

**Увага:** Торгівля фінансовими інструментами несе високий рівень ризику. Використовуйте цей бот виключно для навчальних цілей та бектестингу. Автор не несе відповідальності за будь-які фінансові втрати.
